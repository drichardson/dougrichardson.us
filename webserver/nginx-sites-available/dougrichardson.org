server {
    listen 80 default_server;
    listen [::]:80 default_server;
    server_name dougrichardson.org;
    return 301 https://$server_name$request_uri;
}

server {
    # for debugging only
    # error_log	/var/log/nginx/$server_name.error.log debug;

    #
    # SSL configuration
    #
    listen 443 ssl default_server;
    listen [::]:443 ssl default_server;

    add_header Strict-Transport-Security "max-age=31536000;";

    # CSP
    set $csp "default-src 'none'";
    set $csp "$csp; base-uri 'none'";
    set $csp "$csp; connect-src 'self'";
    set $csp "$csp; font-src 'self'";
    set $csp "$csp; form-action 'none'";
    set $csp "$csp; frame-ancestors 'none'";
    set $csp "$csp; frame-src https://www.youtube.com";
    set $csp "$csp; img-src 'self'";
    set $csp "$csp; script-src 'self' 'unsafe-inline'";
    set $csp "$csp; style-src 'self' 'unsafe-inline'";

    add_header Content-Security-Policy $csp;

    add_header X-Content-Type-Options "nosniff";
    add_header Referrer-Policy "no-referrer";
    add_header Access-Control-Allow-Origin "https://$server_name";
    add_header X-XSS-Protection "1; mode=block";

    expires 5m;

    root /var/www/$server_name;

    index index.html;

    server_name dougrichardson.org;

    location / {
        # First attempt to serve request as file, then
        # as directory, then fall back to displaying a 404.
        try_files $uri $uri/ =404;
    }

    ssl_certificate /etc/letsencrypt/live/dougrichardson.org/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/dougrichardson.org/privkey.pem;
}

